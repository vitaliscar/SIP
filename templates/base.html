{% load static %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema Integral de Inteligencia de Ventas</title>
    <!-- Enlaza nuestros archivos CSS, usando el tag static de Django -->
    <link rel="stylesheet" href="{% static 'css/variables.css' %}" />
    <link rel="stylesheet" href="{% static 'css/base.css' %}" />
    <!-- Fuente Montserrat de Google Fonts para todo el proyecto -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="icon"
      type="image/png"
      href="{% static 'css/REFRESH LOGO.png' %}"
    />
    <style>
      /* Fuente global Montserrat */
      html,
      body,
      .app,
      .container,
      .neumorphic-card,
      .table,
      .primary-button,
      .secondary-button,
      input,
      select,
      textarea,
      button {
        font-family: "Montserrat", Arial, Helvetica, sans-serif !important;
      }
      /* Estilos para el botón de alternar tema dentro de la barra superior */
      .theme-toggle {
        color: var(--text-color-primary);
        background-color: transparent;
        border: line;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background-color 0.3s ease, color 0.3s ease;
        margin-right: 10px;
      }

      .theme-toggle:hover {
        background-color: var(--primary-color);
        color: var(--white-color);
      }

      .theme-toggle svg {
        width: 22px;
        height: 22px;
      }

      /* Iconos de la barra lateral: negro en claro, blanco en oscuro */
      .sidebar__icon {
        stroke: #111 !important;
        color: #111 !important;
        transition: none !important;
      }
      .sidebar__link--active .sidebar__icon,
      .sidebar__link:hover .sidebar__icon {
        stroke: #111 !important;
        color: #111 !important;
        filter: none !important;
      }
      body.dark-mode .sidebar__icon {
        stroke: #fff !important;
        color: #fff !important;
      }
      body.dark-mode .sidebar__link--active .sidebar__icon,
      body.dark-mode .sidebar__link:hover .sidebar__icon {
        stroke: #fff !important;
        color: #fff !important;
        filter: none !important;
      }

      /* Ajustes para la barra superior para alinear los elementos */
      .top-bar__actions {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .main-area {
        padding-top: 0;
        padding-left: 0;
        margin-left: 260px;
      }

      @media (max-width: 768px) {
        .theme-toggle {
          width: 32px;
          height: 32px;
          margin-right: 5px;
        }
        .theme-toggle svg {
          width: 20px;
          height: 20px;
        }
        .top-bar__actions {
          gap: 10px;
        }
      }
    </style>
  </head>
  <body
    class="app{% if user.is_authenticated and user.theme_preference == 'dark' %} dark-mode{% endif %}"
  >
    <div class="app-wrapper">
      <!-- Barra lateral -->
      <aside class="sidebar">
        <img
          src="{% static 'css/REFRESH LOGO.png' %}"
          alt="Logo Ventas Inteligentes"
          class="sidebar__logo-img"
          style="max-width: 90px; margin: 5px auto 28px; display: block"
        />
        <nav class="sidebar__nav">
          <ul class="sidebar__list" style="margin-top: 10px">
            <li class="sidebar__item">
              <a
                href="{% url 'home' %}"
                class="sidebar__link {% if request.resolver_match.url_name == 'home' %}sidebar__link--active{% endif %}"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="sidebar__icon"
                >
                  <path
                    d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"
                  ></path>
                  <path d="M9 22V12h6v10"></path>
                </svg>
                Inicio
              </a>
            </li>
            <li class="sidebar__item">
              <a
                href="{% url 'clients:client_list' %}"
                class="sidebar__link {% if request.resolver_match.url_name == 'client_list' %}sidebar__link--active{% endif %}"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="sidebar__icon"
                >
                  <rect x="3" y="5" width="18" height="14" rx="2" />
                  <circle cx="8" cy="12" r="3" />
                  <line x1="14" y1="10" x2="18" y2="10" />
                  <line x1="14" y1="14" x2="18" y2="14" />
                </svg>
                Clientes
              </a>
            </li>
            <li class="sidebar__item">
              <a
                href="{% url 'products:product_list' %}"
                class="sidebar__link {% if request.resolver_match.url_name == 'product_list' %}sidebar__link--active{% endif %}"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="sidebar__icon feather feather-box"
                >
                  <path
                    d="M21 16V8a2 2 0 0 0-1-1.73L12 2 4 6.27A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73L12 22l8-4.27A2 2 0 0 0 21 16z"
                  ></path>
                  <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                  <line x1="12" y1="22" x2="12" y2="12"></line>
                </svg>
                Productos
              </a>
            </li>
            <li class="sidebar__item">
              <a
                href="{% url 'sales:sale_list' %}"
                class="sidebar__link {% if request.resolver_match.url_name == 'sale_list' %}sidebar__link--active{% endif %}"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="sidebar__icon feather feather-dollar-sign"
                >
                  <line x1="12" y1="1" x2="12" y2="23"></line>
                  <path
                    d="M17 5H9.5a3.5 3.5 0 0 0 0 7H15a3.5 3.5 0 0 1 0 7H6"
                  ></path>
                </svg>
                Ventas
              </a>
            </li>
            <li class="sidebar__item">
              <a
                href="{% url 'goals:goal_list' %}"
                class="sidebar__link {% if request.resolver_match.url_name == 'goal_list' %}sidebar__link--active{% endif %}"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="sidebar__icon feather feather-target"
                >
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="12" y1="8" x2="12" y2="12"></line>
                  <line x1="12" y1="16" x2="12" y2="16"></line>
                </svg>
                Metas
              </a>
            </li>
            <li class="sidebar__item">
              <a
                href="{% url 'reporting:dashboard' %}"
                class="sidebar__link {% if request.resolver_match.url_name == 'dashboard' %}sidebar__link--active{% endif %}"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="sidebar__icon feather feather-bar-chart-2"
                >
                  <line x1="12" y1="20" x2="12" y2="10"></line>
                  <line x1="8" y1="20" x2="8" y2="4"></line>
                  <line x1="16" y1="20" x2="16" y2="14"></line>
                </svg>
                Informes
              </a>
            </li>
            <li class="sidebar__item">
              <a
                href="{% url 'ai_models:forecast_results' %}"
                class="sidebar__link {% if request.resolver_match.url_name == 'forecast_results' %}sidebar__link--active{% endif %}"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="sidebar__icon"
                >
                  <rect x="3" y="8" width="18" height="8" rx="4" />
                  <rect x="7" y="4" width="10" height="4" rx="2" />
                  <circle cx="8" cy="12" r="1.5" />
                  <circle cx="16" cy="12" r="1.5" />
                  <line x1="12" y1="16" x2="12" y2="20" />
                  <line x1="9" y1="20" x2="15" y2="20" />
                  <line x1="12" y1="2" x2="12" y2="4" />
                </svg>
                IA & Predicción
              </a>
            </li>
            {% if user.is_authenticated %}
            <li class="sidebar__item">
              <a href="{% url 'users:profile' %}" class="sidebar__link">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="sidebar__icon feather feather-user"
                >
                  <path
                    d="M20.74 18.58A10.94 10.94 0 0 0 12 17a10.94 10.94 0 0 0-8.74 1.58A2 2 0 0 0 2 20v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a2 2 0 0 0-.26-.84z"
                  ></path>
                  <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5z"></path>
                </svg>
                Mi Perfil
              </a>
            </li>
            <li class="sidebar__item">
              <a href="{% url 'users:logout' %}" class="sidebar__link">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="sidebar__icon feather feather-log-out"
                >
                  <path d="M15 17l5 5m0-10l-5 5"></path>
                  <path d="M4 22H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h2"></path>
                </svg>
                Cerrar Sesión
              </a>
            </li>
            {% else %} {% endif %}
          </ul>
        </nav>
      </aside>

      <!-- Contenido principal y barra superior -->
      <div class="main-area" style="margin-left: 40px">
        <header class="top-bar">
          <div class="top-bar__actions">
            <!-- Botón de alternar tema movido aquí -->
            <button class="theme-toggle" aria-label="Alternar modo oscuro">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="feather feather-moon"
              >
                <path
                  d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
                ></path>
              </svg>
            </button>
            {% if not user.is_authenticated %}
            <a href="{% url 'users:login' %}" class="top-bar__link">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="22"
                height="22"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="top-bar__icon"
              >
                <path d="M3 3h18v18H3z"></path>
                <path d="M9 12h6"></path>
                <path d="M15 12l-3-3m0 6l3-3"></path>
              </svg>
              Iniciar Sesión
            </a>
            <a href="{% url 'users:register' %}" class="top-bar__link">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="22"
                height="22"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="top-bar__icon"
              >
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M17 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M19 8v6M22 11h-6"></path>
              </svg>
              Registrarse
            </a>
            {% endif %}
          </div>
        </header>

        <main class="main-content">
          {% block content %}
          <!-- Sección Hero -->
          <section class="hero">
            <div class="hero__content neumorphic-card">
              <h2 class="hero__title">
                Bienvenido al Sistema Integral de Inteligencia de Ventas
              </h2>
              <p class="hero__description">
                Optimice sus ventas con seguimiento avanzado, predicción
                inteligente y asignación de metas estratégicas. Transforme sus
                datos en decisiones accionables.
              </p>
              <a href="{% url 'users:register' %}" class="primary-button"
                >Empezar Ahora</a
              >
            </div>
          </section>

          <!-- Sección de Características -->
          <section class="features">
            <h2 class="features__title">Funcionalidades Clave</h2>
            <div class="features__grid">
              <div class="features__card neumorphic-card">
                <h3 class="features__card-title">
                  Seguimiento de Ventas Detallado
                </h3>
                <p class="features__card-description">
                  Compare cotizaciones vs. facturas, analice cumplimiento por
                  mes, año, producto, asesor y más.
                </p>
                <a href="{% url 'sales:sale_list' %}" class="secondary-button"
                  >Ver Ventas</a
                >
              </div>
              <div class="features__card neumorphic-card">
                <h3 class="features__card-title">
                  Predicción y Proyección con IA
                </h3>
                <p class="features__card-description">
                  Anticipe tendencias futuras, proyecte ventas y reciba
                  sugerencias inteligentes para su estrategia.
                </p>
                <a
                  href="{% url 'ai_models:forecast_results' %}"
                  class="secondary-button"
                  >Explorar IA</a
                >
              </div>
              <div class="features__card neumorphic-card">
                <h3 class="features__card-title">
                  Gestión de Metas Multinivel
                </h3>
                <p class="features__card-description">
                  Asigne y monitoree metas desde el nivel macro hasta por
                  producto y cliente, considerando el potencial de compra.
                </p>
                <a href="{% url 'goals:goal_list' %}" class="secondary-button"
                  >Gestionar Metas</a
                >
              </div>
            </div>
          </section>
          {% endblock content %}
        </main>
        <!-- Pie de página de la aplicación -->
        <footer class="app-footer">
          <div class="container">
            <p>
              &copy; 2023 Sistema Integral de Inteligencia de Ventas. Todos los
              derechos reservados.
            </p>
          </div>
        </footer>
      </div>
    </div>
    <!-- Script para la funcionalidad del modo oscuro -->
    <script>
      // Selecciona el botón de alternar tema y el cuerpo del documento
      const themeToggle = document.querySelector(".theme-toggle");
      const body = document.body;

      // Añade un evento de clic al botón
      themeToggle.addEventListener("click", () => {
        // Alterna la clase 'dark-mode' en el cuerpo del documento
        // Esto cambiará las variables CSS definidas en ':root' y '.dark-mode'
        body.classList.toggle("dark-mode");
      });

      // Script para manejar la barra lateral en móviles (opcional, si se implementa un botón de hamburguesa)
      // const menuToggle = document.querySelector('.menu-toggle'); // Asumiendo que tienes un botón de menú
      // if (menuToggle) {
      //     menuToggle.addEventListener('click', () => {
      //         body.classList.toggle('sidebar-open');
      //     });
      // }
    </script>
  </body>
</html>
